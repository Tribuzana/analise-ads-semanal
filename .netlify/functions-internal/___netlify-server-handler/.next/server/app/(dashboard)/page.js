(()=>{var e={};e.id=130,e.ids=[130],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},47562:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>m,pages:()=>c,routeModule:()=>u,tree:()=>d}),a(93101),a(85719),a(35866),a(11506);var s=a(23191),r=a(88716),o=a(37922),i=a.n(o),n=a(95231),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);a.d(t,l);let d=["",{children:["(dashboard)",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,93101)),"C:\\Users\\atend\\OneDrive\\Documents\\Cursor Tribuzana\\marketing-analytics\\app\\(dashboard)\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,85719)),"C:\\Users\\atend\\OneDrive\\Documents\\Cursor Tribuzana\\marketing-analytics\\app\\(dashboard)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,11506)),"C:\\Users\\atend\\OneDrive\\Documents\\Cursor Tribuzana\\marketing-analytics\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\atend\\OneDrive\\Documents\\Cursor Tribuzana\\marketing-analytics\\app\\(dashboard)\\page.tsx"],m="/(dashboard)/page",p={require:a,loadChunk:()=>Promise.resolve()},u=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(dashboard)/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},50832:(e,t,a)=>{let s={"1eef6e426185e8694b93fd651e36da9c04f9d3a1":()=>Promise.resolve().then(a.bind(a,67432)).then(e=>e.getDashboardMetrics),dd82733e1d411f352ef091a349fe6ac4871a6073:()=>Promise.resolve().then(a.bind(a,67432)).then(e=>e.getLast4WeeksData),"9d383f78b3294f7a2159cfe822dd240f3d2d2518":()=>Promise.resolve().then(a.bind(a,90811)).then(e=>e.getCampaignPeriodMetrics),ab8d8d4fc9c8d183fd0cec25e567119dbe4ba194:()=>Promise.resolve().then(a.bind(a,90811)).then(e=>e.getMarketingAnalytics),"4fb7291308caa69a64f14ea764e4da7ccd3eddaa":()=>Promise.resolve().then(a.bind(a,35629)).then(e=>e.generateAlerts)};async function r(e,...t){return(await s[e]()).apply(null,t)}e.exports={"1eef6e426185e8694b93fd651e36da9c04f9d3a1":r.bind(null,"1eef6e426185e8694b93fd651e36da9c04f9d3a1"),dd82733e1d411f352ef091a349fe6ac4871a6073:r.bind(null,"dd82733e1d411f352ef091a349fe6ac4871a6073"),"9d383f78b3294f7a2159cfe822dd240f3d2d2518":r.bind(null,"9d383f78b3294f7a2159cfe822dd240f3d2d2518"),ab8d8d4fc9c8d183fd0cec25e567119dbe4ba194:r.bind(null,"ab8d8d4fc9c8d183fd0cec25e567119dbe4ba194"),"4fb7291308caa69a64f14ea764e4da7ccd3eddaa":r.bind(null,"4fb7291308caa69a64f14ea764e4da7ccd3eddaa")}},52934:(e,t,a)=>{Promise.resolve().then(a.bind(a,57505))},57505:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>I});var s=a(10326),r=a(17577),o=a(91806);a(15424);var i=a(46242),n=(0,i.$)("dd82733e1d411f352ef091a349fe6ac4871a6073");(0,i.$)("1eef6e426185e8694b93fd651e36da9c04f9d3a1");var l=a(84725);let d=(e,t)=>0===t?0:e/t;var c=a(73159),m=a(34231),p=a(93653),u=a(33071),g=a(567),h=a(79256),x=a(25696),f=a(11105),v=a(58831);function y({label:e,value:t,delta:a,isPositive:o,data:i,valueType:n="number",dates:l,compareValue:d}){let[c,m]=(0,r.useState)(null),p=(0,r.useRef)(null),y=(0,r.useRef)(null),j=Array.isArray(i)?i:[],b=o?h.Z:x.Z,A="number"==typeof t?t.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):t,w=`${o?"+":""}${a.toFixed(1)}%`,k=function(e,t,a){if(!e||!Array.isArray(e)||0===e.length)return"";if(1===e.length)return"M 0 25 L 200 25";let s=Math.min(...e),r=Math.max(...e)-s||1,o=e.map((t,a)=>({x:a/(e.length-1||1)*200,y:50-(t-s)/r*50})),i=`M ${o[0].x} ${o[0].y}`;for(let e=1;e<o.length;e++){let t=o[e-1],a=o[e];if(1===e){let e=(t.x+a.x)/2,s=(t.y+a.y)/2;i+=` L ${e} ${s}`}if(e<o.length-1){let t=o[e+1],s=(a.x+t.x)/2,r=(a.y+t.y)/2;i+=` Q ${a.x} ${a.y} ${s} ${r}`}else i+=` L ${a.x} ${a.y}`}return i}(j,0,50),N=(e,t)=>{let a=t.getBoundingClientRect(),s=Math.max(0,Math.min(1,(e-a.left)/a.width)),r=j.length||1;return Math.max(0,Math.min(r-1,Math.floor(s*(r-1))))};return(0,s.jsxs)(u.Zb,{children:[s.jsx(u.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:s.jsx(u.ll,{className:"text-sm font-medium",children:e})}),s.jsx(u.aY,{children:(0,s.jsxs)("div",{className:"space-y-3 relative",ref:y,children:[s.jsx("div",{className:"text-2xl font-bold",children:A}),void 0!==d&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["vs ano anterior: ",d]}),(0,s.jsxs)(g.C,{variant:"secondary",className:(0,f.cn)("gap-1 w-fit",o?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:[s.jsx(b,{className:"h-3 w-3"}),w]}),(0,s.jsxs)("div",{className:"mt-4 -mb-2 relative",children:[(0,s.jsxs)("svg",{ref:p,width:"100%",height:50,viewBox:"0 0 200 50",preserveAspectRatio:"none",className:"overflow-visible cursor-crosshair",onMouseMove:e=>{if(!p.current||!j||0===j.length)return;let t=N(e.clientX,p.current),a=j[t],s=l&&l[t]?l[t]:void 0;if(y.current){let r=y.current.getBoundingClientRect();m({x:e.clientX-r.left,y:e.clientY-r.top-60,value:a,index:t,date:s})}},onMouseLeave:()=>{m(null)},children:[s.jsx("defs",{children:(0,s.jsxs)("linearGradient",{id:`gradient-${o?"green":"red"}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[s.jsx("stop",{offset:"0%",stopColor:o?"#16a34a":"#dc2626",stopOpacity:"0.2"}),s.jsx("stop",{offset:"100%",stopColor:o?"#16a34a":"#dc2626",stopOpacity:"0.05"})]})}),k&&s.jsx("path",{d:`${k} L 200 50 L 0 50 Z`,fill:`url(#gradient-${o?"green":"red"})`}),k&&s.jsx("path",{d:k,fill:"none",stroke:o?"#16a34a":"#dc2626",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),c&&j.length>0&&(()=>{let e=Math.min(...j),t=Math.max(...j),a=c.index/(j.length-1||1)*200,r=50-(c.value-e)/(t-e||1)*50;return(0,s.jsxs)(s.Fragment,{children:[s.jsx("line",{x1:a,y1:0,x2:a,y2:50,stroke:"currentColor",strokeWidth:"1",strokeDasharray:"2,2",className:"text-muted-foreground opacity-50"}),s.jsx("circle",{cx:a,cy:r,r:"4",fill:o?"#16a34a":"#dc2626",stroke:"white",strokeWidth:"2"})]})})()]}),c&&(0,s.jsxs)("div",{className:"absolute z-10 px-2 py-1.5 text-xs bg-popover border border-border rounded-md shadow-lg pointer-events-none min-w-[100px]",style:{left:`${c.x}px`,top:`${c.y}px`,transform:"translateX(-50%)"},children:[c.date&&s.jsx("div",{className:"text-muted-foreground text-[10px] mb-1",children:(0,v.p6)(c.date)}),s.jsx("div",{className:"text-foreground font-semibold",children:(e=>{switch(n){case"currency":return(0,v.xG)(e);case"decimal":return e.toFixed(2);default:return(0,v.uf)(e)}})(c.value)})]})]})]})})]})}var j=a(65304),b=a(33261),A=a(31048),w=a(21030),k=a(29357),N=a(78243),D=a(76557);let C=(0,D.Z)("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);var S=a(37202),M=a(17069);function R({analyticsData:e,dashboardMetrics:t}){let a=[],r=e.campaigns.filter(e=>{let a=t.geral.roas;return e.roas>0&&e.roas<.8*a});r.length>0&&a.push({type:"warning",title:"Campanhas em Decl\xednio",description:`${r.length} campanha(s) com ROAS abaixo da m\xe9dia. Considere revisar estrat\xe9gia ou pausar.`,metric:`ROAS m\xe9dio: ${t.geral.roas.toFixed(2)}`});let o=e.campaigns.filter(e=>e.roas>4&&e.spend<1e3);o.length>0&&a.push({type:"opportunity",title:"Oportunidades de Escala",description:`${o.length} campanha(s) com ROAS excelente e baixo investimento. Considere aumentar budget.`,metric:`ROAS m\xe9dio: ${(o.reduce((e,t)=>e+t.roas,0)/o.length).toFixed(2)}`}),t.geral.roas<2&&t.geral.investment>0&&a.push({type:"warning",title:"Performance Abaixo do Esperado",description:"ROAS geral est\xe1 abaixo de 2.0. Revise estrat\xe9gias de campanha e segmenta\xe7\xe3o.",metric:`ROAS atual: ${t.geral.roas.toFixed(2)}`}),t.geral.roas>4&&t.geral.investment>0&&a.push({type:"opportunity",title:"Excelente Performance",description:"ROAS geral est\xe1 acima de 4.0. Considere aumentar investimento para escalar resultados.",metric:`ROAS atual: ${t.geral.roas.toFixed(2)}`});let i=t.googleAds.investment/(t.geral.investment||1);i>.8?a.push({type:"info",title:"Desequil\xedbrio de Investimento",description:"Mais de 80% do investimento est\xe1 no Google Ads. Considere diversificar para Meta Ads."}):i<.2&&a.push({type:"info",title:"Desequil\xedbrio de Investimento",description:"Mais de 80% do investimento est\xe1 no Meta Ads. Considere diversificar para Google Ads."});let n=e.campaigns.filter(e=>e.campaign_status?.toUpperCase()==="PAUSED"&&e.roas>3);return(n.length>0&&a.push({type:"opportunity",title:"Campanhas Pausadas com Potencial",description:`${n.length} campanha(s) pausada(s) com ROAS hist\xf3rico acima de 3.0. Considere reativar.`}),0===a.length)?(0,s.jsxs)(u.Zb,{children:[(0,s.jsxs)(u.Ol,{children:[(0,s.jsxs)(u.ll,{className:"flex items-center gap-2",children:[s.jsx(C,{className:"h-5 w-5"}),"Insights Autom\xe1ticos"]}),s.jsx(u.SZ,{children:"An\xe1lise autom\xe1tica de performance e oportunidades"})]}),s.jsx(u.aY,{children:s.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum insight dispon\xedvel no momento. Suas campanhas est\xe3o performando bem!"})})]}):(0,s.jsxs)(u.Zb,{children:[(0,s.jsxs)(u.Ol,{children:[(0,s.jsxs)(u.ll,{className:"flex items-center gap-2",children:[s.jsx(C,{className:"h-5 w-5"}),"Insights Autom\xe1ticos"]}),s.jsx(u.SZ,{children:"An\xe1lise autom\xe1tica de performance e oportunidades"})]}),s.jsx(u.aY,{className:"space-y-4",children:a.map((e,t)=>s.jsx("div",{className:`p-4 rounded-lg border ${"warning"===e.type?"bg-yellow-50 border-yellow-200":"opportunity"===e.type?"bg-green-50 border-green-200":"bg-blue-50 border-blue-200"}`,children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:["warning"===e.type&&s.jsx(S.Z,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),"opportunity"===e.type&&s.jsx(M.Z,{className:"h-5 w-5 text-green-600 mt-0.5"}),"info"===e.type&&s.jsx(C,{className:"h-5 w-5 text-blue-600 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("h4",{className:"font-semibold text-sm",children:e.title}),s.jsx(g.C,{variant:"secondary",className:"warning"===e.type?"bg-yellow-100 text-yellow-800":"opportunity"===e.type?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800",children:"warning"===e.type?"Aten\xe7\xe3o":"opportunity"===e.type?"Oportunidade":"Info"})]}),s.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:e.description}),e.metric&&s.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:e.metric})]})]})},t))})]})}let P=(0,D.Z)("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),E=(0,D.Z)("PauseCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);var O=a(71821),_=a(57671),Z=a(21066),G=a(12714);function $(e){if(!e||e.length<2)return{delta:0,isPositive:!0};if(2===e.length){let t=e[0]||0,a=e[1]||0;if(0===t)return{delta:a>0?100:0,isPositive:a>=t};let s=(a-t)/t*100;return{delta:Math.abs(s),isPositive:s>=0}}let t=Math.max(1,Math.floor(e.length/2)),a=e.slice(0,t),s=e.slice(t),r=a.reduce((e,t)=>e+(t||0),0)/a.length,o=s.reduce((e,t)=>e+(t||0),0)/s.length;if(0===r)return{delta:o>0?100:0,isPositive:o>=r};let i=(o-r)/r*100;return{delta:Math.abs(i),isPositive:i>=0}}function F(e,t){return e&&0!==e.length?{data:e.map(e=>e[t]||0),dates:e.map(e=>e.date)}:{data:[],dates:[]}}function I(){let{metrics:e,loading:t,error:a}=function(){(0,o.j)();let[e,t]=(0,r.useState)(null),[a,s]=(0,r.useState)(!0),[i,n]=(0,r.useState)(null);return{metrics:e,loading:a,error:i}}(),{data:i}=(0,l.j)(),{temporalData:g,campaignKPIs:h,loading:x}=function(){let e=(0,o.j)(),[t,a]=(0,r.useState)([]),[s,i]=(0,r.useState)({activeGoogle:0,pausedGoogle:0,activeMeta:0,pausedMeta:0}),[l,c]=(0,r.useState)(!0),[m,p]=(0,r.useState)(null);return(0,r.useEffect)(()=>{(async function(){c(!0),p(null);try{let t=await n({selectedHotels:e.selectedHotels,selectedCidades:e.selectedCidades,selectedEstados:e.selectedEstados}),s=function(e){let t=new Map;return e.forEach(e=>{t.has(e.date)||t.set(e.date,{date:e.date,spend:0,revenue:0});let a=t.get(e.date);a.spend+=parseFloat(String(e.spend||0)),a.revenue+=parseFloat(String(e.conversions_value||0))}),Array.from(t.values()).map(e=>({date:e.date,spend:e.spend,revenue:e.revenue,roas:d(e.revenue,e.spend)})).sort((e,t)=>e.date.localeCompare(t.date))}(t),r=function(e){let t=new Map;e.forEach(e=>{let a=`${e.campaign_id}_${e.platform}`;t.has(a)||t.set(a,{platform:"Google"===e.platform||"Google Ads"===e.platform?"Google":"Meta",status:e.campaign_status})});let a=0,s=0,r=0,o=0;return t.forEach(e=>{let t=e.status?.toUpperCase()||"",i="ACTIVE"===t||"ENABLED"===t||""===t,n="PAUSED"===t||"PAUSE"===t;"Google"===e.platform?(i&&a++,n&&s++):(i&&r++,n&&o++)}),{activeGoogle:a,pausedGoogle:s,activeMeta:r,pausedMeta:o}}(t);a(s),i(r)}catch(e){p(e.message||"Erro desconhecido ao buscar dados das \xfaltimas 4 semanas"),console.error("[useLast4Weeks] Erro:",e)}finally{c(!1)}})()},[e.selectedHotels.join(","),e.selectedCidades.join(","),e.selectedEstados.join(",")]),{temporalData:t,campaignKPIs:s,loading:l,error:m}}(),{compareYearAgo:f}=(0,o.j)(),[D,C]=(0,r.useState)(!1);return t?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard"}),s.jsx("p",{className:"text-muted-foreground",children:"Vis\xe3o geral das campanhas Google Ads e Meta Ads"})]}),s.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(8)].map((e,t)=>s.jsx(j.O,{className:"h-[140px]"},t))})]}):a?s.jsx("div",{className:"flex h-full items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center space-y-4",children:[s.jsx("p",{className:"text-lg font-medium text-red-600",children:"Erro ao carregar dados"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:a}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground mt-4 p-4 bg-muted rounded-lg",children:[(0,s.jsxs)("p",{children:[s.jsx("strong",{children:"Dica:"})," Verifique:"]}),(0,s.jsxs)("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[s.jsx("li",{children:"Se voc\xea est\xe1 autenticado (veja seu nome no canto superior direito)"}),s.jsx("li",{children:"Se as datas dos filtros est\xe3o definidas"}),s.jsx("li",{children:"O console do navegador para mais detalhes"})]})]})]})}):e?(0,s.jsxs)("div",{className:"space-y-10 pb-8",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard"}),s.jsx("p",{className:"text-muted-foreground",children:"Vis\xe3o geral das campanhas Google Ads e Meta Ads"})]}),(0,s.jsxs)("div",{className:"py-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-6",children:"Status das Campanhas"}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[s.jsx(p.i,{title:"Campanhas Ativas Google",value:(0,v.uf)(h.activeGoogle),icon:s.jsx(P,{className:"h-4 w-4"})}),s.jsx(p.i,{title:"Campanhas Pausadas Google",value:(0,v.uf)(h.pausedGoogle),icon:s.jsx(E,{className:"h-4 w-4"})}),s.jsx(p.i,{title:"Campanhas Ativas Meta",value:(0,v.uf)(h.activeMeta),icon:s.jsx(P,{className:"h-4 w-4"})}),s.jsx(p.i,{title:"Campanhas Pausadas Meta",value:(0,v.uf)(h.pausedMeta),icon:s.jsx(E,{className:"h-4 w-4"})})]})]}),i&&s.jsx(R,{analyticsData:i,dashboardMetrics:e}),(0,s.jsxs)("div",{className:"py-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-6",children:"M\xe9tricas Gerais"}),s.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:i?.temporalData&&i.temporalData.length>0?(0,s.jsxs)(s.Fragment,{children:[(()=>{let{data:t,dates:a}=F(i.temporalData,"spend"),{delta:r,isPositive:o}=e.comparison?{delta:e.comparison.geral.delta.investment,isPositive:e.comparison.geral.delta.investment>=0}:$(t),n=e.comparison?(0,v.xG)(e.comparison.geral.previous.investment):void 0;return s.jsx(y,{label:"Investimento Total",value:(0,v.xG)(e.geral.investment),delta:r,isPositive:o,data:t,dates:a,valueType:"currency",compareValue:n})})(),(()=>{let{data:t,dates:a}=F(i.temporalData,"revenue"),{delta:r,isPositive:o}=e.comparison?{delta:e.comparison.geral.delta.revenue,isPositive:e.comparison.geral.delta.revenue>=0}:$(t),n=e.comparison?(0,v.xG)(e.comparison.geral.previous.revenue):void 0;return s.jsx(y,{label:"Receita Total",value:(0,v.xG)(e.geral.revenue),delta:r,isPositive:o,data:t,dates:a,valueType:"currency",compareValue:n})})(),(()=>{let{data:t,dates:a}=F(i.temporalData,"conversions"),{delta:r,isPositive:o}=e.comparison?{delta:e.comparison.geral.delta.conversions,isPositive:e.comparison.geral.delta.conversions>=0}:$(t),n=e.comparison?(0,v.uf)(e.comparison.geral.previous.conversions):void 0;return s.jsx(y,{label:"Convers\xf5es",value:(0,v.uf)(e.geral.conversions),delta:r,isPositive:o,data:t,dates:a,valueType:"number",compareValue:n})})(),(()=>{let{data:t,dates:a}=F(i.temporalData,"roas"),{delta:r,isPositive:o}=f&&e.comparison?{delta:e.comparison.geral.delta.roas,isPositive:e.comparison.geral.delta.roas>=0}:$(t),n=f&&e.comparison?e.comparison.geral.previous.roas.toFixed(2):void 0;return s.jsx(y,{label:"ROAS",value:e.geral.roas.toFixed(2),delta:r,isPositive:o,data:t,dates:a,valueType:"decimal",compareValue:n})})()]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(p.i,{title:"Investimento Total",value:(0,v.xG)(e.geral.investment),icon:s.jsx(O.Z,{className:"h-4 w-4"}),change:e.comparison?e.comparison.geral.delta.investment:void 0,compareValue:e.comparison?(0,v.xG)(e.comparison.geral.previous.investment):void 0}),s.jsx(p.i,{title:"Receita Total",value:(0,v.xG)(e.geral.revenue),icon:s.jsx(M.Z,{className:"h-4 w-4"}),change:e.comparison?e.comparison.geral.delta.revenue:void 0,compareValue:e.comparison?(0,v.xG)(e.comparison.geral.previous.revenue):void 0}),s.jsx(p.i,{title:"Convers\xf5es",value:(0,v.uf)(e.geral.conversions),icon:s.jsx(_.Z,{className:"h-4 w-4"}),change:e.comparison?e.comparison.geral.delta.conversions:void 0,compareValue:e.comparison?(0,v.uf)(e.comparison.geral.previous.conversions):void 0}),s.jsx(p.i,{title:"ROAS",value:e.geral.roas.toFixed(2),subtitle:e.comparison?void 0:"Return on Ad Spend",icon:s.jsx(M.Z,{className:"h-4 w-4"}),change:e.comparison?e.comparison.geral.delta.roas:void 0,compareValue:e.comparison?e.comparison.geral.previous.roas.toFixed(2):void 0})]})})]}),g.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-xl font-semibold",children:"\xdaltimas 4 Semanas"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(A._,{htmlFor:"weekly-toggle",className:"text-sm text-muted-foreground",children:"Di\xe1rio"}),s.jsx(b.r,{id:"weekly-toggle",checked:D,onCheckedChange:C}),s.jsx(A._,{htmlFor:"weekly-toggle",className:"text-sm text-muted-foreground",children:"Semanal (Dom-S\xe1b)"})]})]}),s.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:(()=>{let e=D?function(e){let t=new Map;return e.forEach(e=>{let a=new Date(e.date),s=(0,c.z)(a,{weekStartsOn:0}),r=(0,m.WU)(s,"yyyy-MM-dd");t.has(r)||t.set(r,{spend:0,revenue:0,startDate:s});let o=t.get(r);o.spend+=e.spend,o.revenue+=e.revenue}),Array.from(t.entries()).map(([e,t])=>{let a=new Date(t.startDate);return a.setDate(a.getDate()+6),{date:e,spend:t.spend,revenue:t.revenue,roas:d(t.revenue,t.spend),weekLabel:`${(0,m.WU)(t.startDate,"dd/MM")} - ${(0,m.WU)(a,"dd/MM")}`}}).sort((e,t)=>e.date.localeCompare(t.date))}(g):g.map(e=>({...e,weekLabel:new Date(e.date).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})})),t=e=>D&&"weekLabel"in e?e.weekLabel:new Date(e.date).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(u.Zb,{children:[(0,s.jsxs)(u.Ol,{children:[s.jsx(u.ll,{children:"Investimento"}),s.jsx(u.SZ,{children:D?"Investimento acumulado por semana (domingo a s\xe1bado)":"Investimento di\xe1rio das \xfaltimas 4 semanas"})]}),s.jsx(u.aY,{children:s.jsx(w.w,{data:e.map(e=>({date:t(e),Investimento:e.spend})),dataKeys:[{key:"Investimento",name:"Investimento",color:"hsl(var(--primary))"}],yAxisFormatter:e=>(0,v.xG)(e)})})]}),(0,s.jsxs)(u.Zb,{children:[(0,s.jsxs)(u.Ol,{children:[s.jsx(u.ll,{children:"Receita"}),s.jsx(u.SZ,{children:D?"Receita acumulada por semana (domingo a s\xe1bado)":"Receita di\xe1ria das \xfaltimas 4 semanas"})]}),s.jsx(u.aY,{children:s.jsx(w.w,{data:e.map(e=>({date:t(e),Receita:e.revenue})),dataKeys:[{key:"Receita",name:"Receita",color:"#82ca9d"}],yAxisFormatter:e=>(0,v.xG)(e)})})]}),(0,s.jsxs)(u.Zb,{children:[(0,s.jsxs)(u.Ol,{children:[s.jsx(u.ll,{children:"ROAS"}),s.jsx(u.SZ,{children:D?"ROAS m\xe9dio por semana (domingo a s\xe1bado)":"ROAS di\xe1rio das \xfaltimas 4 semanas"})]}),s.jsx(u.aY,{children:s.jsx(w.w,{data:e.map(e=>({date:t(e),ROAS:e.roas})),dataKeys:[{key:"ROAS",name:"ROAS",color:"#8884d8"}],yAxisFormatter:e=>`${Number(e).toFixed(2).replace(".",",")}x`})})]})]})})()})]}),i&&i.temporalData.length>0&&s.jsx("div",{className:"py-6",children:(0,s.jsxs)(u.Zb,{children:[(0,s.jsxs)(u.Ol,{children:[s.jsx(u.ll,{children:"Evolu\xe7\xe3o Temporal - Investimento vs Receita"}),s.jsx(u.SZ,{children:"Compara\xe7\xe3o de investimento e receita ao longo do tempo"})]}),s.jsx(u.aY,{children:s.jsx(w.w,{data:i.temporalData.map(e=>({date:new Date(e.date).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}),Investimento:e.spend,Receita:e.revenue})),dataKeys:[{key:"Investimento",name:"Investimento",color:"hsl(var(--primary))"},{key:"Receita",name:"Receita",color:"#82ca9d"}]})})]})}),(0,s.jsxs)("div",{children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Google Ads"}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[s.jsx(p.i,{title:"Investimento",value:(0,v.xG)(e.googleAds.investment),icon:s.jsx(O.Z,{className:"h-4 w-4"}),change:e.comparison?e.comparison.googleAds.delta.investment:void 0,compareValue:e.comparison?(0,v.xG)(e.comparison.googleAds.previous.investment):void 0}),s.jsx(p.i,{title:"Receita",value:(0,v.xG)(e.googleAds.revenue),icon:s.jsx(M.Z,{className:"h-4 w-4"}),change:e.comparison?e.comparison.googleAds.delta.revenue:void 0,compareValue:e.comparison?(0,v.xG)(e.comparison.googleAds.previous.revenue):void 0}),s.jsx(p.i,{title:"ROAS",value:e.googleAds.roas.toFixed(2),change:e.comparison?e.comparison.googleAds.delta.roas:void 0,compareValue:e.comparison?e.comparison.googleAds.previous.roas.toFixed(2):void 0}),s.jsx(p.i,{title:"CPA",value:(0,v.xG)(e.googleAds.cpa),change:e.comparison?e.comparison.googleAds.delta.cpa:void 0,compareValue:e.comparison?(0,v.xG)(e.comparison.googleAds.previous.cpa):void 0}),s.jsx(p.i,{title:"Cliques",value:(0,v.uf)(e.googleAds.clicks),icon:s.jsx(Z.Z,{className:"h-4 w-4"}),change:e.comparison?e.comparison.googleAds.delta.clicks:void 0,compareValue:e.comparison?(0,v.uf)(e.comparison.googleAds.previous.clicks):void 0}),s.jsx(p.i,{title:"Impress\xf5es",value:(0,v.uf)(e.googleAds.impressions),icon:s.jsx(G.Z,{className:"h-4 w-4"}),change:e.comparison?e.comparison.googleAds.delta.impressions:void 0,compareValue:e.comparison?(0,v.uf)(e.comparison.googleAds.previous.impressions):void 0}),s.jsx(p.i,{title:"CTR",value:(0,v.rl)(e.googleAds.ctr),change:e.comparison?e.comparison.googleAds.delta.ctr:void 0,compareValue:e.comparison?(0,v.rl)(e.comparison.googleAds.previous.ctr):void 0}),s.jsx(p.i,{title:"CPC",value:(0,v.xG)(e.googleAds.cpc),change:e.comparison?e.comparison.googleAds.delta.cpc:void 0,compareValue:e.comparison?(0,v.xG)(e.comparison.googleAds.previous.cpc):void 0})]})]}),(0,s.jsxs)("div",{className:"py-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-6",children:"Meta Ads"}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[s.jsx(p.i,{title:"Investimento",value:(0,v.xG)(e.metaAds.investment),icon:s.jsx(O.Z,{className:"h-4 w-4"}),change:e.comparison?e.comparison.metaAds.delta.investment:void 0,compareValue:e.comparison?(0,v.xG)(e.comparison.metaAds.previous.investment):void 0}),s.jsx(p.i,{title:"Receita",value:(0,v.xG)(e.metaAds.revenue),icon:s.jsx(M.Z,{className:"h-4 w-4"}),change:e.comparison?e.comparison.metaAds.delta.revenue:void 0,compareValue:e.comparison?(0,v.xG)(e.comparison.metaAds.previous.revenue):void 0}),s.jsx(p.i,{title:"ROAS",value:e.metaAds.roas.toFixed(2),change:e.comparison?e.comparison.metaAds.delta.roas:void 0,compareValue:e.comparison?e.comparison.metaAds.previous.roas.toFixed(2):void 0}),s.jsx(p.i,{title:"CPA",value:(0,v.xG)(e.metaAds.cpa),change:e.comparison?e.comparison.metaAds.delta.cpa:void 0,compareValue:e.comparison?(0,v.xG)(e.comparison.metaAds.previous.cpa):void 0}),s.jsx(p.i,{title:"Cliques",value:(0,v.uf)(e.metaAds.clicks),icon:s.jsx(Z.Z,{className:"h-4 w-4"}),change:e.comparison?e.comparison.metaAds.delta.clicks:void 0,compareValue:e.comparison?(0,v.uf)(e.comparison.metaAds.previous.clicks):void 0}),s.jsx(p.i,{title:"Impress\xf5es",value:(0,v.uf)(e.metaAds.impressions),icon:s.jsx(G.Z,{className:"h-4 w-4"}),change:e.comparison?e.comparison.metaAds.delta.impressions:void 0,compareValue:e.comparison?(0,v.uf)(e.comparison.metaAds.previous.impressions):void 0}),s.jsx(p.i,{title:"CTR",value:(0,v.rl)(e.metaAds.ctr),change:e.comparison?e.comparison.metaAds.delta.ctr:void 0,compareValue:e.comparison?(0,v.rl)(e.comparison.metaAds.previous.ctr):void 0}),s.jsx(p.i,{title:"CPC",value:(0,v.xG)(e.metaAds.cpc),change:e.comparison?e.comparison.metaAds.delta.cpc:void 0,compareValue:e.comparison?(0,v.xG)(e.comparison.metaAds.previous.cpc):void 0})]})]}),i&&s.jsx("div",{className:"py-6",children:(0,s.jsxs)(u.Zb,{children:[(0,s.jsxs)(u.Ol,{children:[s.jsx(u.ll,{children:"Distribui\xe7\xe3o de Investimento por Plataforma"}),s.jsx(u.SZ,{children:"Investimento em cada plataforma"})]}),s.jsx(u.aY,{children:s.jsx(k.u,{data:[{name:"Google Ads",value:e.googleAds.investment},{name:"Meta Ads",value:e.metaAds.investment}]})})]})}),i&&i.topCampaigns.length>0&&s.jsx("div",{className:"py-6",children:(0,s.jsxs)(u.Zb,{children:[(0,s.jsxs)(u.Ol,{children:[s.jsx(u.ll,{children:"Top 5 Campanhas por ROAS"}),s.jsx(u.SZ,{children:"Campanhas com melhor retorno sobre investimento"})]}),s.jsx(u.aY,{children:s.jsx(N.v,{data:i.topCampaigns.slice(0,5).map(e=>({campanha:e.campaign_name.length>30?e.campaign_name.substring(0,30)+"...":e.campaign_name,ROAS:e.roas})),dataKeys:[{key:"ROAS",name:"ROAS",color:"hsl(var(--primary))"}],xAxisKey:"campanha",yAxisFormatter:e=>`${Number(e).toFixed(2).replace(".",",")}x`})})]})})]}):null}},78243:(e,t,a)=>{"use strict";a.d(t,{v:()=>p});var s=a(10326),r=a(81398),o=a(49844),i=a(18423),n=a(62637),l=a(9997),d=a(89495),c=a(41449),m=a(48190);function p({data:e,dataKeys:t,xAxisKey:a,yAxisFormatter:p}){return s.jsx(r.h,{width:"100%",height:350,children:(0,s.jsxs)(o.v,{data:e,margin:{top:5,right:30,left:20,bottom:60},children:[s.jsx(i.q,{strokeDasharray:"3 3"}),s.jsx(n.K,{dataKey:a,tick:{fontSize:11},angle:-45,textAnchor:"end",height:80,interval:0}),s.jsx(l.B,{tick:{fontSize:12},tickFormatter:p}),s.jsx(d.u,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"6px"},formatter:(e,t)=>"ROAS"===t||"roas"===t?`${Number(e).toFixed(2).replace(".",",")}x`:e}),s.jsx(c.D,{}),t.map(({key:e,name:t,color:a})=>s.jsx(m.$Q,{dataKey:e,name:t,fill:a},e))]})})}},21030:(e,t,a)=>{"use strict";a.d(t,{w:()=>u});var s=a(10326),r=a(81398),o=a(14958),i=a(18423),n=a(62637),l=a(9997),d=a(89495),c=a(41449),m=a(71094),p=a(58831);function u({data:e,dataKeys:t,xAxisKey:a="date",yAxisFormatter:u}){return s.jsx(r.h,{width:"100%",height:300,children:(0,s.jsxs)(o.w,{data:e,children:[s.jsx(i.q,{strokeDasharray:"3 3"}),s.jsx(n.K,{dataKey:a,tick:{fontSize:12},angle:-45,textAnchor:"end",height:80}),s.jsx(l.B,{tick:{fontSize:12},tickFormatter:u}),s.jsx(d.u,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"6px"},formatter:(e,a)=>{let s=t.find(e=>e.key===a||e.name===a);return s?.formatter?s.formatter(e):"Investimento"===a||"Receita"===a?(0,p.xG)(e):"ROAS"===a||"roas"===a?`${Number(e).toFixed(2).replace(".",",")}x`:e}}),s.jsx(c.D,{}),t.map(({key:e,name:t,color:a})=>s.jsx(m.x1,{type:"monotone",dataKey:e,name:t,stroke:a,strokeWidth:2,dot:{r:4}},e))]})})}},29357:(e,t,a)=>{"use strict";a.d(t,{u:()=>p});var s=a(10326),r=a(81398),o=a(14141),i=a(97651),n=a(99630),l=a(89495),d=a(41449),c=a(58831);let m=["hsl(var(--primary))","hsl(var(--secondary))","#8884d8","#82ca9d","#ffc658","#ff7300"];function p({data:e,colors:t=m}){return s.jsx(r.h,{width:"100%",height:300,children:(0,s.jsxs)(o.u,{children:[s.jsx(i.by,{data:e,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:t,value:a})=>`${e}: ${(100*(t||0)).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:e.map((e,a)=>s.jsx(n.b,{fill:t[a%t.length]},`cell-${a}`))}),s.jsx(l.u,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"6px"},formatter:e=>(0,c.xG)(e)}),s.jsx(d.D,{})]})})}},84725:(e,t,a)=>{"use strict";a.d(t,{j:()=>o});var s=a(17577),r=a(91806);function o(e){(0,r.j)();let[t,a]=(0,s.useState)(null),[o,i]=(0,s.useState)(!0),[n,l]=(0,s.useState)(null);return{data:t,loading:o,error:n}}a(39797)},37202:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(76557).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},25696:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(76557).Z)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]])},79256:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(76557).Z)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]])},71821:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(76557).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},12714:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(76557).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},11019:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(76557).Z)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},21066:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(76557).Z)("MousePointerClick",[["path",{d:"m9 9 5 12 1.8-5.2L21 14Z",key:"1b76lo"}],["path",{d:"M7.2 2.2 8 5.1",key:"1cfko1"}],["path",{d:"m5.1 8-2.9-.8",key:"1go3kf"}],["path",{d:"M14 4.1 12 6",key:"ita8i4"}],["path",{d:"m6 12-1.9 2",key:"mnht97"}]])},57671:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(76557).Z)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},93101:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});let s=(0,a(68570).createProxy)(String.raw`C:\Users\atend\OneDrive\Documents\Cursor Tribuzana\marketing-analytics\app\(dashboard)\page.tsx#default`)},67432:(e,t,a)=>{"use strict";a.r(t),a.d(t,{getDashboardMetrics:()=>l,getLast4WeeksData:()=>u});var s=a(27745);a(26461);var r=a(94964),o=a(88504),i=a(34894),n=a(58191);async function l(e){let t=(0,r.e)();try{if(!e.startDate||!e.endDate)return console.warn("[getDashboardMetrics] Datas n\xe3o definidas nos filtros"),{geral:c(),googleAds:c(),metaAds:c()};console.log("[getDashboardMetrics] Iniciando busca:",{startDate:e.startDate,endDate:e.endDate,selectedHotels:e.selectedHotels.length});let a=t.from("metricas_ads").select("*").gte("date",e.startDate).lte("date",e.endDate),s=[];if(e.selectedCidades.length>0||e.selectedEstados.length>0){let a=t.from("hoteis_config").select("id, nome_hotel").eq("ativo",!0);e.selectedCidades.length>0&&a.in("cidade",e.selectedCidades),e.selectedEstados.length>0&&a.in("estado",e.selectedEstados);let{data:r}=await a;if(s=r?.map(e=>e.id)||[],0===s.length)return console.warn("[getDashboardMetrics] Nenhum hotel encontrado para os filtros de cidade/estado"),{geral:c(),googleAds:c(),metaAds:c()}}if(e.selectedHotels.length>0){let{data:s,error:r}=await t.from("metricas_ads").select("client").gte("date",e.startDate).lte("date",e.endDate);r&&console.error("[getDashboardMetrics] Erro ao buscar clientes \xfanicos:",r);let o=new Set,n=new Set(s?.map(e=>e.client).filter(e=>!!e&&"string"==typeof e)||[]);if(console.log("[getDashboardMetrics] Clientes \xfanicos encontrados:",n.size),e.selectedHotels.forEach(e=>{let t=(0,i.Iu)(e);n.forEach(e=>{if(e){let a=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");(a===s||a.includes(s)||s.includes(a))&&o.add(e)}})}),console.log("[getDashboardMetrics] Clientes correspondentes:",Array.from(o)),!(o.size>0))return console.warn("[getDashboardMetrics] Nenhum cliente correspondente encontrado para os hot\xe9is selecionados"),{geral:c(),googleAds:c(),metaAds:c()};a=a.in("client",Array.from(o))}else if(s.length>0){let{data:r}=await t.from("hoteis_config").select("nome_hotel").in("id",s);if(r&&r.length>0){let{data:s}=await t.from("metricas_ads").select("client").gte("date",e.startDate).lte("date",e.endDate),o=new Set,n=new Set(s?.map(e=>e.client).filter(e=>!!e&&"string"==typeof e)||[]);r.forEach(e=>{let t=(0,i.Iu)(e.nome_hotel);n.forEach(e=>{if(e){let a=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");(a===s||a.includes(s)||s.includes(a))&&o.add(e)}})}),o.size>0&&(a=a.in("client",Array.from(o)))}}let{data:r,error:o}=await a;if(o)throw console.error("[getDashboardMetrics] Erro na query do Supabase:",{message:o.message,details:o.details,hint:o.hint,code:o.code}),o;if(console.log(`[getDashboardMetrics] Encontrados ${r?.length||0} registros para o per\xedodo ${e.startDate} a ${e.endDate}`),!r||0===r.length)return console.warn("[getDashboardMetrics] Nenhum dado encontrado para o per\xedodo selecionado"),{geral:c(),googleAds:c(),metaAds:c()};let l=r.filter(e=>"Google Ads"===e.platform||"Google"===e.platform),u=r.filter(e=>"Meta Ads"===e.platform||"Meta"===e.platform);console.log(`[getDashboardMetrics] Google: ${l.length} registros, Meta: ${u.length} registros`);let g=d([...l,...u]),h=d(l),x=d(u);console.log("[getDashboardMetrics] M\xe9tricas calculadas:",{geral:{investment:g.investment,revenue:g.revenue,roas:g.roas},googleAds:{investment:h.investment,revenue:h.revenue,roas:h.roas},metaAds:{investment:x.investment,revenue:x.revenue,roas:x.roas}});let f={geral:g,googleAds:h,metaAds:x},v=(0,n.jp)(e.startDate,e.endDate);console.log("[getDashboardMetrics] Buscando dados do per\xedodo anterior:",v);let y=await m(t,v.startDate,v.endDate,e.selectedHotels,e.selectedCidades,e.selectedEstados),j=y.filter(e=>"Google Ads"===e.platform||"Google"===e.platform),b=y.filter(e=>"Meta Ads"===e.platform||"Meta"===e.platform),A=d([...j,...b]),w=d(j),k=d(b);return f.comparison={geral:p(g,A),googleAds:p(h,w),metaAds:p(x,k)},console.log("[getDashboardMetrics] Compara\xe7\xe3o com per\xedodo anterior calculada:",{geral:f.comparison.geral.delta,googleAds:f.comparison.googleAds.delta,metaAds:f.comparison.metaAds.delta}),f}catch(e){return console.error("[getDashboardMetrics] Erro ao buscar m\xe9tricas:",{message:e?.message,stack:e?.stack}),{geral:c(),googleAds:c(),metaAds:c()}}}function d(e){let t=e.reduce((e,t)=>e+(t.spend||0),0),a=e.reduce((e,t)=>e+(t.conversions_value||0),0),s=e.reduce((e,t)=>e+(t.conversions||0),0),r=e.reduce((e,t)=>e+(t.clicks||0),0),i=e.reduce((e,t)=>e+(t.impressions||0),0);return{investment:t,revenue:a,conversions:s,roas:(0,o.zk)(a,t),clicks:r,impressions:i,ctr:(0,o.O7)(r,i),cpc:(0,o.Zv)(t,r),cpa:(0,o.GI)(t,s)}}function c(){return{investment:0,revenue:0,conversions:0,roas:0,clicks:0,impressions:0,ctr:0,cpc:0,cpa:0}}async function m(e,t,a,s,r,o){let n=e.from("metricas_ads").select("*").gte("date",t).lte("date",a);if(s.length>0){let{data:r}=await e.from("metricas_ads").select("client").gte("date",t).lte("date",a),o=new Set,l=new Set(r?.map(e=>e.client).filter(e=>!!e&&"string"==typeof e)||[]);if(s.forEach(e=>{let t=(0,i.Iu)(e);l.forEach(e=>{if(e){let a=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");(a===s||a.includes(s)||s.includes(a))&&o.add(e)}})}),!(o.size>0))return[];n=n.in("client",Array.from(o))}else if(r.length>0||o.length>0){let s=e.from("hoteis_config").select("id, nome_hotel").eq("ativo",!0);r.length>0&&s.in("cidade",r),o.length>0&&s.in("estado",o);let{data:l}=await s,d=l?.map(e=>e.id)||[];if(d.length>0){let{data:s}=await e.from("hoteis_config").select("nome_hotel").in("id",d);if(s&&s.length>0){let{data:r}=await e.from("metricas_ads").select("client").gte("date",t).lte("date",a),o=new Set,l=new Set(r?.map(e=>e.client).filter(e=>!!e&&"string"==typeof e)||[]);s.forEach(e=>{let t=(0,i.Iu)(e.nome_hotel);l.forEach(e=>{if(e){let a=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");(a===s||a.includes(s)||s.includes(a))&&o.add(e)}})}),o.size>0&&(n=n.in("client",Array.from(o)))}}}let{data:l,error:d}=await n;return d?(console.error("[fetchMetricsForPeriod] Erro ao buscar dados:",d),[]):l||[]}function p(e,t){let a=(e,t)=>0===t?e>0?100:0:(e-t)/t*100;return{previous:t,delta:{investment:a(e.investment,t.investment),revenue:a(e.revenue,t.revenue),conversions:a(e.conversions,t.conversions),roas:a(e.roas,t.roas),clicks:a(e.clicks,t.clicks),impressions:a(e.impressions,t.impressions),ctr:a(e.ctr,t.ctr),cpc:a(e.cpc,t.cpc),cpa:a(e.cpa,t.cpa)}}}async function u(e){let t=(0,r.e)(),{startDate:a,endDate:s}=(0,n.OB)(),o=t.from("metricas_ads").select("*").gte("date",a).lte("date",s);if(e.selectedHotels.length>0){let{data:r}=await t.from("metricas_ads").select("client").gte("date",a).lte("date",s),n=new Set,l=new Set(r?.map(e=>e.client).filter(e=>!!e&&"string"==typeof e)||[]);if(e.selectedHotels.forEach(e=>{let t=(0,i.Iu)(e);l.forEach(e=>{if(e){let a=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");(a===s||a.includes(s)||s.includes(a))&&n.add(e)}})}),!(n.size>0))return[];o=o.in("client",Array.from(n))}else if(e.selectedCidades.length>0||e.selectedEstados.length>0){let r=t.from("hoteis_config").select("id, nome_hotel").eq("ativo",!0);e.selectedCidades.length>0&&r.in("cidade",e.selectedCidades),e.selectedEstados.length>0&&r.in("estado",e.selectedEstados);let{data:n}=await r,l=n?.map(e=>e.id)||[];if(l.length>0){let{data:e}=await t.from("hoteis_config").select("nome_hotel").in("id",l);if(e&&e.length>0){let{data:r}=await t.from("metricas_ads").select("client").gte("date",a).lte("date",s),n=new Set,l=new Set(r?.map(e=>e.client).filter(e=>!!e&&"string"==typeof e)||[]);e.forEach(e=>{let t=(0,i.Iu)(e.nome_hotel);l.forEach(e=>{if(e){let a=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");(a===s||a.includes(s)||s.includes(a))&&n.add(e)}})}),n.size>0&&(o=o.in("client",Array.from(n)))}}}let{data:l,error:d}=await o;return d?(console.error("[getLast4WeeksData] Erro ao buscar dados:",d),[]):l||[]}(0,a(85723).h)([l,u]),(0,s.j)("1eef6e426185e8694b93fd651e36da9c04f9d3a1",l),(0,s.j)("dd82733e1d411f352ef091a349fe6ac4871a6073",u)},60371:(e,t,a)=>{"use strict";a.d(t,{fC:()=>w,bU:()=>k});var s=a(17577),r=a(82561),o=a(48051),i=a(10326),n=a(52067),l=a(53405),d=a(2566);a(60962);var c=Symbol("radix.slottable");function m(e){return s.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===c}var p=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let a=function(e){let t=function(e){let t=s.forwardRef((e,t)=>{let{children:a,...r}=e;if(s.isValidElement(a)){let e,i;let n=(e=Object.getOwnPropertyDescriptor(a.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?a.ref:(e=Object.getOwnPropertyDescriptor(a,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?a.props.ref:a.props.ref||a.ref,l=function(e,t){let a={...t};for(let s in t){let r=e[s],o=t[s];/^on[A-Z]/.test(s)?r&&o?a[s]=(...e)=>{let t=o(...e);return r(...e),t}:r&&(a[s]=r):"style"===s?a[s]={...r,...o}:"className"===s&&(a[s]=[r,o].filter(Boolean).join(" "))}return{...e,...a}}(r,a.props);return a.type!==s.Fragment&&(l.ref=t?(0,o.F)(t,n):n),s.cloneElement(a,l)}return s.Children.count(a)>1?s.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),a=s.forwardRef((e,a)=>{let{children:r,...o}=e,n=s.Children.toArray(r),l=n.find(m);if(l){let e=l.props.children,r=n.map(t=>t!==l?t:s.Children.count(e)>1?s.Children.only(null):s.isValidElement(e)?e.props.children:null);return(0,i.jsx)(t,{...o,ref:a,children:s.isValidElement(e)?s.cloneElement(e,void 0,r):null})}return(0,i.jsx)(t,{...o,ref:a,children:r})});return a.displayName=`${e}.Slot`,a}(`Primitive.${t}`),r=s.forwardRef((e,s)=>{let{asChild:r,...o}=e,n=r?a:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,i.jsx)(n,{...o,ref:s})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),u="Switch",[g,h]=function(e,t=[]){let a=[],r=()=>{let t=a.map(e=>s.createContext(e));return function(a){let r=a?.[e]||t;return s.useMemo(()=>({[`__scope${e}`]:{...a,[e]:r}}),[a,r])}};return r.scopeName=e,[function(t,r){let o=s.createContext(r),n=a.length;a=[...a,r];let l=t=>{let{scope:a,children:r,...l}=t,d=a?.[e]?.[n]||o,c=s.useMemo(()=>l,Object.values(l));return(0,i.jsx)(d.Provider,{value:c,children:r})};return l.displayName=t+"Provider",[l,function(a,i){let l=i?.[e]?.[n]||o,d=s.useContext(l);if(d)return d;if(void 0!==r)return r;throw Error(`\`${a}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let a=()=>{let a=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let r=a.reduce((t,{useScope:a,scopeName:s})=>{let r=a(e)[`__scope${s}`];return{...t,...r}},{});return s.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return a.scopeName=t.scopeName,a}(r,...t)]}(u),[x,f]=g(u),v=s.forwardRef((e,t)=>{let{__scopeSwitch:a,name:l,checked:d,defaultChecked:c,required:m,disabled:g,value:h="on",onCheckedChange:f,form:v,...y}=e,[j,w]=s.useState(null),k=(0,o.e)(t,e=>w(e)),N=s.useRef(!1),D=!j||v||!!j.closest("form"),[C,S]=(0,n.T)({prop:d,defaultProp:c??!1,onChange:f,caller:u});return(0,i.jsxs)(x,{scope:a,checked:C,disabled:g,children:[(0,i.jsx)(p.button,{type:"button",role:"switch","aria-checked":C,"aria-required":m,"data-state":A(C),"data-disabled":g?"":void 0,disabled:g,value:h,...y,ref:k,onClick:(0,r.Mj)(e.onClick,e=>{S(e=>!e),D&&(N.current=e.isPropagationStopped(),N.current||e.stopPropagation())})}),D&&(0,i.jsx)(b,{control:j,bubbles:!N.current,name:l,value:h,checked:C,required:m,disabled:g,form:v,style:{transform:"translateX(-100%)"}})]})});v.displayName=u;var y="SwitchThumb",j=s.forwardRef((e,t)=>{let{__scopeSwitch:a,...s}=e,r=f(y,a);return(0,i.jsx)(p.span,{"data-state":A(r.checked),"data-disabled":r.disabled?"":void 0,...s,ref:t})});j.displayName=y;var b=s.forwardRef(({__scopeSwitch:e,control:t,checked:a,bubbles:r=!0,...n},c)=>{let m=s.useRef(null),p=(0,o.e)(m,c),u=(0,l.D)(a),g=(0,d.t)(t);return s.useEffect(()=>{let e=m.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(u!==a&&t){let s=new Event("click",{bubbles:r});t.call(e,a),e.dispatchEvent(s)}},[u,a,r]),(0,i.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...n,tabIndex:-1,ref:p,style:{...n.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function A(e){return e?"checked":"unchecked"}b.displayName="SwitchBubbleInput";var w=v,k=j},63443:(e,t,a)=>{"use strict";a.d(t,{v:()=>o});var s=a(67921),r=a(81507);function o(e,t){let a=(0,r.j)(),o=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,i=(0,s.Q)(e),n=i.getDay();return i.setDate(i.getDate()+((n<o?-7:0)+6-(n-o))),i.setHours(23,59,59,999),i}}};var t=require("../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[276,992,162,808,981,220,347],()=>a(47562));module.exports=s})();