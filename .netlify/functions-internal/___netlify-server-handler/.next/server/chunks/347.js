"use strict";exports.id=347,exports.ids=[347],exports.modules={93653:(e,t,a)=>{a.d(t,{i:()=>d});var s=a(10326),n=a(33071),r=a(567),i=a(11019),o=a(79256),l=a(25696),c=a(11105);function d({title:e,value:t,change:a,subtitle:d,icon:g,compareValue:p,compareLabel:m="vs ano anterior"}){return(0,s.jsxs)(n.Zb,{children:[(0,s.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(n.ll,{className:"text-sm font-medium",children:e}),g&&s.jsx("div",{className:"text-muted-foreground",children:g})]}),(0,s.jsxs)(n.aY,{children:[s.jsx("div",{className:"text-2xl font-bold",children:t}),void 0!==p&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[m,": ",p]}),d&&!p&&s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:d}),void 0!==a&&(0,s.jsxs)(r.C,{variant:"secondary",className:(0,c.cn)("mt-2 gap-1",void 0===a||0===a?"bg-gray-100 text-gray-800":a>0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:[void 0===a||0===a?s.jsx(i.Z,{className:"h-3 w-3"}):a>0?s.jsx(o.Z,{className:"h-3 w-3"}):s.jsx(l.Z,{className:"h-3 w-3"}),Math.abs(a).toFixed(1),"%"]})]})]})}},65304:(e,t,a)=>{a.d(t,{O:()=>r});var s=a(10326),n=a(11105);function r({className:e,...t}){return s.jsx("div",{className:(0,n.cn)("animate-pulse rounded-md bg-muted",e),...t})}},33261:(e,t,a)=>{a.d(t,{r:()=>o});var s=a(10326),n=a(17577),r=a(60371),i=a(11105);let o=n.forwardRef(({className:e,...t},a)=>s.jsx(r.fC,{className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:a,children:s.jsx(r.bU,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));o.displayName=r.fC.displayName},39797:(e,t,a)=>{a.d(t,{v:()=>n}),a(15424);var s=a(46242),n=(0,s.$)("9d383f78b3294f7a2159cfe822dd240f3d2d2518");(0,s.$)("ab8d8d4fc9c8d183fd0cec25e567119dbe4ba194")},58831:(e,t,a)=>{a.d(t,{p6:()=>i,rl:()=>r,uf:()=>n,xG:()=>s});let s=e=>null==e?"R$ 0,00":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),n=e=>null==e?"0":new Intl.NumberFormat("pt-BR").format(e),r=(e,t=2)=>null==e?"0%":`${e.toFixed(t)}%`,i=e=>{let t="string"==typeof e?new Date(e):e;return new Intl.DateTimeFormat("pt-BR").format(t)}},90811:(e,t,a)=>{a.r(t),a.d(t,{getCampaignPeriodMetrics:()=>m,getMarketingAnalytics:()=>l});var s=a(27745);a(26461);var n=a(94964),r=a(88504),i=a(34894),o=a(58191);async function l(e,t){let a=(0,n.e)();try{if(!e.startDate||!e.endDate)return console.warn("[getMarketingAnalytics] Datas n\xe3o definidas nos filtros"),{campaigns:[],objectiveAnalysis:[],temporalData:[],topCampaigns:[]};let s=a.from("metricas_ads").select("*").gte("date",e.startDate).lte("date",e.endDate),n=[];if(e.selectedCidades.length>0||e.selectedEstados.length>0){let t=a.from("hoteis_config").select("id, nome_hotel").eq("ativo",!0);e.selectedCidades.length>0&&t.in("cidade",e.selectedCidades),e.selectedEstados.length>0&&t.in("estado",e.selectedEstados);let{data:s}=await t;if(n=s?.map(e=>e.id)||[],0===n.length)return console.warn("[getMarketingAnalytics] Nenhum hotel encontrado para os filtros de cidade/estado"),{campaigns:[],objectiveAnalysis:[],temporalData:[],topCampaigns:[]}}if(e.selectedHotels.length>0){let{data:t}=await a.from("metricas_ads").select("client").gte("date",e.startDate).lte("date",e.endDate),n=new Set,r=new Set(t?.map(e=>e.client).filter(e=>!!e&&"string"==typeof e)||[]);e.selectedHotels.forEach(e=>{let t=(0,i.Iu)(e);r.forEach(e=>{if(e){let a=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");(a===t||a.includes(t)||t.includes(a))&&n.add(e)}})}),n.size>0&&(s=s.in("client",Array.from(n)))}else if(n.length>0){let{data:t}=await a.from("hoteis_config").select("nome_hotel").in("id",n);if(t&&t.length>0){let{data:n}=await a.from("metricas_ads").select("client").gte("date",e.startDate).lte("date",e.endDate),r=new Set,o=new Set(n?.map(e=>e.client).filter(e=>!!e&&"string"==typeof e)||[]);t.forEach(e=>{let t=(0,i.Iu)(e.nome_hotel);o.forEach(e=>{if(e){let a=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");(a===s||a.includes(s)||s.includes(a))&&r.add(e)}})}),r.size>0&&(s=s.in("client",Array.from(r)))}}if(t?.platforms&&t.platforms.length>0){let e=new Set;t.platforms.forEach(t=>{"Google Ads"===t||"Google"===t?(e.add("Google"),e.add("Google Ads")):"Meta Ads"===t||"Meta"===t?(e.add("Meta"),e.add("Meta Ads")):e.add(t)}),s=s.in("platform",Array.from(e))}t?.statuses&&t.statuses.length>0&&(s=s.in("campaign_status",t.statuses));let r=e.selectedObjectives.length>0?e.selectedObjectives:t?.objectives||[];r.length>0&&(s=s.in("campaign_objective",r));let{data:l,error:m}=await s;if(m)throw console.error("[getMarketingAnalytics] Erro na query:",m),m;console.log(`[getMarketingAnalytics] Encontrados ${l?.length||0} registros`);let f=l||[];e.selectedResultTypes.length>0&&(f=f.filter(t=>e.selectedResultTypes.some(e=>{switch(e){case"Convers\xf5es":return parseInt(String(t.conversions||0),10)>0;case"Leads":return parseInt(String(t.action_leads||0),10)>0;case"Cliques em Links":return parseInt(String(t.action_link_clicks||0),10)>0;case"Engajamentos em Posts":return parseInt(String(t.estimated_reach||0),10)>0||parseInt(String(t.frequency||0),10)>0;case"Compras":return parseInt(String(t.action_omni_purchase||0),10)>0||parseFloat(String(t.conversions_value||0))>0;default:return!1}})));let u=c(f),h=d(f),v=g(f),y=u.sort((e,t)=>t.roas-e.roas).slice(0,10),w={campaigns:u,objectiveAnalysis:h,temporalData:v,topCampaigns:y},b=(0,o.jp)(e.startDate,e.endDate);console.log("[getMarketingAnalytics] Buscando dados do per\xedodo anterior:",b);let _=await p(a,b.startDate,b.endDate,e.selectedHotels,e.selectedCidades,e.selectedEstados,{...t,selectedObjectives:e.selectedObjectives,selectedResultTypes:e.selectedResultTypes}),D=c(_||[]),k=d(_||[]),S=g(_||[]),x=D.sort((e,t)=>t.roas-e.roas).slice(0,10);return w.comparison={campaigns:D,objectiveAnalysis:k,temporalData:S,topCampaigns:x},console.log("[getMarketingAnalytics] Compara\xe7\xe3o com per\xedodo anterior calculada"),w}catch(e){return console.error("[getMarketingAnalytics] Erro ao buscar analytics:",e),{campaigns:[],objectiveAnalysis:[],temporalData:[],topCampaigns:[]}}}function c(e){let t=new Map;return e.forEach(e=>{let a=`${e.campaign_id}_${e.platform}`;t.has(a)||t.set(a,{campaign_id:e.campaign_id,campaign_name:e.campaign_name,client:e.client,platform:"Google"===e.platform?"Google Ads":"Meta"===e.platform?"Meta Ads":e.platform,campaign_objective:e.campaign_objective,campaign_status:e.campaign_status,spend:0,revenue:0,conversions:0,clicks:0,impressions:0});let s=t.get(a);s.spend+=parseFloat(String(e.spend||0)),s.revenue+=parseFloat(String(e.conversions_value||0)),s.conversions+=parseInt(String(e.conversions||0),10),s.clicks+=parseInt(String(e.clicks||0),10),s.impressions+=parseInt(String(e.impressions||0),10)}),Array.from(t.values()).map(e=>({...e,roas:(0,r.zk)(e.revenue,e.spend),cpa:(0,r.GI)(e.spend,e.conversions),cpc:(0,r.Zv)(e.spend,e.clicks),ctr:(0,r.O7)(e.clicks,e.impressions)}))}function d(e){let t=new Map;return e.forEach(e=>{let a=e.campaign_objective||"N\xe3o definido";t.has(a)||t.set(a,{objective:a,campaigns:new Set,spend:0,revenue:0,conversions:0});let s=t.get(a);s.campaigns.add(e.campaign_id),s.spend+=parseFloat(String(e.spend||0)),s.revenue+=parseFloat(String(e.conversions_value||0)),s.conversions+=parseInt(String(e.conversions||0),10)}),Array.from(t.values()).map(e=>({objective:e.objective,campaigns:e.campaigns.size,spend:e.spend,revenue:e.revenue,conversions:e.conversions,roas:(0,r.zk)(e.revenue,e.spend)}))}function g(e){let t=new Map;return e.forEach(e=>{t.has(e.date)||t.set(e.date,{date:e.date,spend:0,revenue:0,conversions:0});let a=t.get(e.date);a.spend+=parseFloat(String(e.spend||0)),a.revenue+=parseFloat(String(e.conversions_value||0)),a.conversions+=parseInt(String(e.conversions||0),10)}),Array.from(t.values()).map(e=>({...e,roas:(0,r.zk)(e.revenue,e.spend)})).sort((e,t)=>e.date.localeCompare(t.date))}async function p(e,t,a,s,n,r,o){let l=e.from("metricas_ads").select("*").gte("date",t).lte("date",a);if(s.length>0){let{data:n}=await e.from("metricas_ads").select("client").gte("date",t).lte("date",a),r=new Set,o=new Set(n?.map(e=>e.client).filter(e=>!!e&&"string"==typeof e)||[]);if(s.forEach(e=>{let t=(0,i.Iu)(e);o.forEach(e=>{if(e){let a=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");(a===t||a.includes(t)||t.includes(a))&&r.add(e)}})}),!(r.size>0))return[];l=l.in("client",Array.from(r))}else if(n.length>0||r.length>0){let s=e.from("hoteis_config").select("id, nome_hotel").eq("ativo",!0);n.length>0&&s.in("cidade",n),r.length>0&&s.in("estado",r);let{data:o}=await s,c=o?.map(e=>e.id)||[];if(c.length>0){let{data:s}=await e.from("hoteis_config").select("nome_hotel").in("id",c);if(s&&s.length>0){let{data:n}=await e.from("metricas_ads").select("client").gte("date",t).lte("date",a),r=new Set,o=new Set(n?.map(e=>e.client).filter(e=>!!e&&"string"==typeof e)||[]);s.forEach(e=>{let t=(0,i.Iu)(e.nome_hotel);o.forEach(e=>{if(e){let a=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");(a===s||a.includes(s)||s.includes(a))&&r.add(e)}})}),r.size>0&&(l=l.in("client",Array.from(r)))}}}if(o?.platforms&&o.platforms.length>0){let e=new Set;o.platforms.forEach(t=>{"Google Ads"===t||"Google"===t?(e.add("Google"),e.add("Google Ads")):"Meta Ads"===t||"Meta"===t?(e.add("Meta"),e.add("Meta Ads")):e.add(t)}),l=l.in("platform",Array.from(e))}o?.statuses&&o.statuses.length>0&&(l=l.in("campaign_status",o.statuses));let{data:c,error:d}=await l;return d?(console.error("[fetchAnalyticsForPeriod] Erro ao buscar dados:",d),[]):c||[]}async function m(e,t,a){let s=(0,n.e)();try{if(!a.startDate||!a.endDate)return{spend:0,revenue:0,conversions:0,clicks:0,impressions:0,roas:0,cpa:0,cpc:0,ctr:0};let n=s.from("metricas_ads").select("*").eq("campaign_id",e).in("platform","Google Ads"===t||"Google"===t?["Google","Google Ads"]:["Meta","Meta Ads"]).gte("date",a.startDate).lte("date",a.endDate);if(a.selectedHotels.length>0){let{data:e}=await s.from("metricas_ads").select("client").gte("date",a.startDate).lte("date",a.endDate),t=new Set,r=new Set(e?.map(e=>e.client).filter(e=>!!e&&"string"==typeof e)||[]);a.selectedHotels.forEach(e=>{let a=(0,i.Iu)(e);r.forEach(e=>{if(e){let s=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");(s===a||s.includes(a)||a.includes(s))&&t.add(e)}})}),t.size>0&&(n=n.in("client",Array.from(t)))}else if(a.selectedCidades.length>0||a.selectedEstados.length>0){let e=s.from("hoteis_config").select("id, nome_hotel").eq("ativo",!0);a.selectedCidades.length>0&&e.in("cidade",a.selectedCidades),a.selectedEstados.length>0&&e.in("estado",a.selectedEstados);let{data:t}=await e,r=t?.map(e=>e.id)||[];if(r.length>0){let{data:e}=await s.from("hoteis_config").select("nome_hotel").in("id",r);if(e&&e.length>0){let{data:t}=await s.from("metricas_ads").select("client").gte("date",a.startDate).lte("date",a.endDate),r=new Set,o=new Set(t?.map(e=>e.client).filter(e=>!!e&&"string"==typeof e)||[]);e.forEach(e=>{let t=(0,i.Iu)(e.nome_hotel);o.forEach(e=>{if(e){let a=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");(a===s||a.includes(s)||s.includes(a))&&r.add(e)}})}),r.size>0&&(n=n.in("client",Array.from(r)))}}}let{data:o,error:l}=await n;if(l)return console.error("[getCampaignPeriodMetrics] Erro na query:",l),{spend:0,revenue:0,conversions:0,clicks:0,impressions:0,roas:0,cpa:0,cpc:0,ctr:0};let c={spend:0,revenue:0,conversions:0,clicks:0,impressions:0};return o?.forEach(e=>{c.spend+=parseFloat(String(e.spend||0)),c.revenue+=parseFloat(String(e.conversions_value||0)),c.conversions+=parseInt(String(e.conversions||0),10),c.clicks+=parseInt(String(e.clicks||0),10),c.impressions+=parseInt(String(e.impressions||0),10)}),{...c,roas:(0,r.zk)(c.revenue,c.spend),cpa:(0,r.GI)(c.spend,c.conversions),cpc:(0,r.Zv)(c.spend,c.clicks),ctr:(0,r.O7)(c.clicks,c.impressions)}}catch(e){return console.error("[getCampaignPeriodMetrics] Erro ao buscar m\xe9tricas:",e),{spend:0,revenue:0,conversions:0,clicks:0,impressions:0,roas:0,cpa:0,cpc:0,ctr:0}}}(0,a(85723).h)([l,m]),(0,s.j)("ab8d8d4fc9c8d183fd0cec25e567119dbe4ba194",l),(0,s.j)("9d383f78b3294f7a2159cfe822dd240f3d2d2518",m)},58191:(e,t,a)=>{a.d(t,{OB:()=>o,jp:()=>l});var s=a(63443),n=a(85641),r=a(65931),i=a(95744);let o=()=>{let e=new Date,t=(0,s.v)((0,n.k)(e,7),{weekStartsOn:0}),a=(0,r.z)((0,n.k)(t,27),{weekStartsOn:0});return{startDate:(0,i.WU)(a,"yyyy-MM-dd"),endDate:(0,i.WU)(t,"yyyy-MM-dd")}},l=(e,t)=>{let a=new Date(e),s=new Date(t).getTime()-a.getTime(),r=(0,n.k)(a,1),o=(0,n.k)(r,Math.ceil(s/864e5));return{startDate:(0,i.WU)(o,"yyyy-MM-dd"),endDate:(0,i.WU)(r,"yyyy-MM-dd")}}},34894:(e,t,a)=>{function s(e){let t=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"").trim(),a={dpny:"dpny",grinbergsvillagehotel:"grinbergs",grinbergs:"grinbergs"};if(a[t])return a[t];let s=t.split(/\s+/).filter(e=>e.length>2);return s.length>0?s[0]:t}a.d(t,{Iu:()=>s})}};